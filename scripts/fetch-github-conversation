#!/usr/bin/env python3
"""CLI wrapper for fetching a single GitHub conversation.

This wrapper delegates to the library function in `doppiozero.fetch_github_conversation`.
"""
import argparse
import sys
from pathlib import Path


def main():
    parser = argparse.ArgumentParser(prog="fetch-github-conversation")
    parser.add_argument("input", help="GitHub URL or owner/repo/type/number")
    parser.add_argument("--cache-path", help="Cache root directory", default=None)
    parser.add_argument(
        "--updated-at", help="Only fetch if remote is newer than this ISO timestamp", default=None
    )
    args = parser.parse_args()

    # Import inside main to keep CLI tiny and avoid heavy imports at module import time
    from doppiozero.fetch_github_conversation import fetch_github_conversation

    try:
        data = fetch_github_conversation(
            args.input, cache_path=args.cache_path, updated_at=args.updated_at
        )
        import json

        json.dump(data, sys.stdout, indent=2)
    except Exception as e:
        print(f"Error: {e}", file=sys.stderr)
        sys.exit(1)


if __name__ == "__main__":
    main()
